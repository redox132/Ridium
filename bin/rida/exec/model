#!/usr/bin/env php
<?php

#!/usr/bin/env php

// Check if the correct command is used
if ($argc < 3 || $argv[1] !== 'make:model') {
    echo "----- Rida Model Generator -----\n";

    echo "Usage: php bin/rida/exec/rida make:model ModelName\n";
    exit(1);
}

$modelName = ucfirst($argv[2]);
$tableName = strtolower($modelName) . 's';

$stubPath = __DIR__ . '/../stubs/model.stub'; // Adjusted path
$targetDir = __DIR__ . '/../../../app/Models'; // Assumes app/ is at project root
$targetFile = $targetDir . '/' . ucfirst($modelName) . '.php';

// Ensure the stub exists
if (!file_exists($stubPath)) {
    echo "Model stub not found at $stubPath\n";
    exit(1);
}

// Create Models directory if it doesn't exist
if (!is_dir($targetDir)) {
    mkdir($targetDir, 0777, true);
}

// Read and replace placeholders
$stub = file_get_contents($stubPath);
$stub = str_replace(['{{modelName}}', '{{tableName}}'], [$modelName, $tableName], $stub);

// Write the model file
file_put_contents($targetFile, $stub);

echo "
#####   #######  ###           #
#    #     #     #   #       #   #    
#####      #     #    #     #     #
# #        #     #    #    ######### 
#  #       #     #   #    #         #
#    #  #######  ###     #           # ";

echo "\n";
echo "--------------------------------------------------------------------\n";
echo "\n";

echo "Model $modelName created at app/Models/$modelName.php" .  date('Y-m-d H:i:s') . "\n";

echo "\n";
echo "--------------------------------------------------------------------\n";